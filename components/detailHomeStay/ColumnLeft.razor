@using GoStay.Peter.Models.ListingDetail
@using GoStay.Peter
@using GoStay.Seli.srcComponent
@using System.Collections.ObjectModel
@using HotelApiV56.Model
@inject IJSRuntime JsRuntime
@inject NavigationManager NavigationManager
@inject Flowbie Flowbie

<div class="col-span-2 flex flex-col gap-4 text-[#424F64] lg:pr-10 pr-0">
    @if (ResponseHost != null)
    {
        @foreach (var item in ResponseHost)
        {
            @if (item.Permission == 101)
            {
                <div class="w-full">
                    <div class="w-full flex justify-between py-3">
                        <div>
                            <p class="text-2xl font-bold">Chủ phòng @item.Host.Fullname</p>
                            <p class="text-sm text-gray-400">@item.Host.BrandName </p>
                        </div>
                        <div>
                            <button @onclick="() => User(item.Host.Id)">
                                <img class="w-[60px] h-[60px] rounded-full" src="@(item.Host.AvatarUrl != "" ? item.Host.AvatarUrl : "https://static.dayladau.com/home/public/assets/img/no_profile.17dcba4.png")" alt="">
                            </button>
                        </div>
                    </div>
                    <hr class="w-full border-[#A0A4B8]"/>
                </div>
            }
        }
    }

    <p class="text-xl font-bold">Giới thiệu chỗ ở</p>
    <div class="text-[#5D7293]">
        @for (int i = 0; i < ListDescription.Length; i++)
        {
            <p class="leading-8">
                @ListDescription[i]
            </p>
        }
    </div>

    <p class="text-xl font-bold">Nơi này có những gì cho bạn</p>
    <div class=" gap-4 pl-5 text-[#5D7293] leading-8">
        <ul class="grid sm:grid-cols-2 grid-cols-1">
            <li class="flex gap-2 py-1 @Tv">
                <div class="w-6 h-6 pt-1">
                    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" display="block" fill="currentcolor" name="tv" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M9 29v-2h2v-2H6a5 5 0 01-4.995-4.783L1 20V8a5 5 0 014.783-4.995L6 3h20a5 5 0 014.995 4.783L31 8v12a5 5 0 01-4.783 4.995L26 25h-5v2h2v2zm10-4h-6v2h6zm7-20H6a3 3 0 00-2.995 2.824L3 8v12a3 3 0 002.824 2.995L6 23h20a3 3 0 002.995-2.824L29 20V8a3 3 0 00-2.824-2.995z"></path>
                    </svg>
                </div>
                <p>TV</p>
            </li>
            <li class="flex gap-2 py-1 @Netflix">
                <div class="w-6 h-6 pt-1">
                    <svg viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" name="netflix" class="mr-3 text-red" style="width: 24px; height: 24px; display: block;">
                        <path d="M0 0h24v24H0z" fill="none">
                        </path><path d="M15.984 17.208L16 2h2v20a7.593 7.593 0 00-2.02-.5L8 6.302V21.5a7.335 7.335 0 00-2 .5V2h2l7.984 15.208z" stroke="#5D7293"></path>
                    </svg>
                </div>
                <p>Netflix</p>
            </li>
            <li class="flex gap-2 py-1 @Essentials">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" name="toothbrush" class="mr-3">
                        <path stroke="#5D7293" d="M22.223 7.531a.451.451 0 00-.446-.422h-8a.445.445 0 00-.441.422l-.89 16a.426.426 0 00.12.328c.082.09.2.141.325.141h9.777c.121 0 .238-.05.32-.14a.426.426 0 00.121-.329zM13.359 23.11L14.2 8h7.156l.84 15.11zm0 0"></path>
                        <path stroke="#5D7293" d="M20.445 11.555H15.11c-.242 0-.441.199-.441.445v3.11c0 .245.2.445.441.445h5.336c.246 0 .446-.2.446-.446V12c0-.246-.2-.445-.446-.445zM20 14.668h-4.445v-2.223H20zm0 0M15.555 6.223H20c.246 0 .445-.2.445-.446V2.22c0-1.223-1-2.219-2.226-2.219h-.883a2.226 2.226 0 00-2.227 2.219v3.558c0 .246.2.446.446.446zM16 2.219c0-.735.602-1.328 1.336-1.328h.883c.738 0 1.336.593 1.336 1.328v3.113H16zm0 0M3.105 0h-.433A1.78 1.78 0 00.89 1.777v21.778c0 .246.195.445.441.445h3.113a.45.45 0 00.325-.14.452.452 0 00.117-.333L4.012 10.41c.523-.308.879-.87.879-1.523v-7.11C4.89.797 4.09 0 3.105 0zM1.777 23.11V10.667h1.364l.828 12.441zM4 8.886c0 .492-.402.89-.895.89H1.777v-8c0-.488.403-.886.895-.886h.433c.493 0 .895.398.895.886zm0 0M9.11.89H6a.442.442 0 00-.445.442c0 .246.199.445.445.445h3.11c.245 0 .445-.199.445-.445s-.2-.441-.446-.441zm0 0M9.11 2.223H6c-.246 0-.445.199-.445.445s.199.441.445.441h3.11a.442.442 0 00.445-.441c0-.246-.2-.445-.446-.445zm0 0M9.11 3.555H6a.445.445 0 100 .89h3.11a.445.445 0 100-.89zm0 0M9.11 4.89H6a.442.442 0 00-.445.442c0 .246.199.445.445.445h3.11c.245 0 .445-.199.445-.445s-.2-.441-.446-.441zm0 0M9.11 6.223H6c-.246 0-.445.199-.445.445s.199.441.445.441h3.11a.442.442 0 00.445-.441c0-.246-.2-.445-.446-.445zm0 0M9.11 7.555H6a.445.445 0 100 .89h3.11a.445.445 0 100-.89zm0 0M9.11 8.89H6a.442.442 0 00-.445.442c0 .246.199.445.445.445h3.11c.245 0 .445-.199.445-.445s-.2-.441-.446-.441zm0 0"></path>
                    </svg>
                </div>
                <p>Bàn chải, kem đánh răng</p>
            </li>
            <li class="flex gap-2 py-1 @Pool">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" name="pool" size="14">
                        <path d="M0 0h24v24H0z" stroke="none"></path>
                        <path d="M2 20a2.4 2.4 0 002 1 2.4 2.4 0 002-1 2.4 2.4 0 012-1 2.4 2.4 0 012 1 2.4 2.4 0 002 1 2.4 2.4 0 002-1 2.4 2.4 0 012-1 2.4 2.4 0 012 1 2.4 2.4 0 002 1 2.4 2.4 0 002-1M2 16a2.4 2.4 0 002 1 2.4 2.4 0 002-1 2.4 2.4 0 012-1 2.4 2.4 0 012 1 2.4 2.4 0 002 1 2.4 2.4 0 002-1 2.4 2.4 0 012-1 2.4 2.4 0 012 1 2.4 2.4 0 002 1 2.4 2.4 0 002-1M15 12V4.5a1.5 1.5 0 013 0M9 12V4.5a1.5 1.5 0 00-3 0M15 5H9M9 10h6"></path>
                    </svg>
                </div>
                <p>Bể bơi</p>
            </li>
            <li class="flex gap-2 py-1 @FreeParkingCar">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" display="block" fill="currentcolor" name="free parking car" size="14" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M26 19a1 1 0 11-2 0 1 1 0 012 0zM7 18a1 1 0 100 2 1 1 0 000-2zm20.693-5l.42 1.119C29.253 15.036 30 16.426 30 18v9c0 1.103-.897 2-2 2h-2c-1.103 0-2-.897-2-2v-2H8v2c0 1.103-.897 2-2 2H4c-1.103 0-2-.897-2-2v-9c0-1.575.746-2.965 1.888-3.882L4.308 13H2v-2h3v.152l1.82-4.854A2.009 2.009 0 018.693 5h14.614c.829 0 1.58.521 1.873 1.297L27 11.151V11h3v2h-2.307zM6 25H4v2h2v-2zm22 0h-2v2h2v-2zm0-2v-5c0-1.654-1.346-3-3-3H7c-1.654 0-3 1.346-3 3v5h24zm-3-10h.557l-2.25-6H8.693l-2.25 6H25zm-15 7h12v-2H10v2z"></path>
                    </svg>
                </div>
                <p>Miễn phí đỗ xe ôtô</p>
            </li>
            <li class="flex gap-2 py-1 @FreeParkingStreet">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" display="block" fill="currentcolor" name="free parking car" size="14" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M26 19a1 1 0 11-2 0 1 1 0 012 0zM7 18a1 1 0 100 2 1 1 0 000-2zm20.693-5l.42 1.119C29.253 15.036 30 16.426 30 18v9c0 1.103-.897 2-2 2h-2c-1.103 0-2-.897-2-2v-2H8v2c0 1.103-.897 2-2 2H4c-1.103 0-2-.897-2-2v-9c0-1.575.746-2.965 1.888-3.882L4.308 13H2v-2h3v.152l1.82-4.854A2.009 2.009 0 018.693 5h14.614c.829 0 1.58.521 1.873 1.297L27 11.151V11h3v2h-2.307zM6 25H4v2h2v-2zm22 0h-2v2h2v-2zm0-2v-5c0-1.654-1.346-3-3-3H7c-1.654 0-3 1.346-3 3v5h24zm-3-10h.557l-2.25-6H8.693l-2.25 6H25zm-15 7h12v-2H10v2z"></path>
                    </svg>
                </div>
                <p>Miễn phí đỗ xe trên đường</p>
            </li>
            <li class="flex gap-2 py-1 @FreeParkingMoto">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" aria-hidden="true" display="block" fill="currentcolor" name="free parking car" size="14" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M26 19a1 1 0 11-2 0 1 1 0 012 0zM7 18a1 1 0 100 2 1 1 0 000-2zm20.693-5l.42 1.119C29.253 15.036 30 16.426 30 18v9c0 1.103-.897 2-2 2h-2c-1.103 0-2-.897-2-2v-2H8v2c0 1.103-.897 2-2 2H4c-1.103 0-2-.897-2-2v-9c0-1.575.746-2.965 1.888-3.882L4.308 13H2v-2h3v.152l1.82-4.854A2.009 2.009 0 018.693 5h14.614c.829 0 1.58.521 1.873 1.297L27 11.151V11h3v2h-2.307zM6 25H4v2h2v-2zm22 0h-2v2h2v-2zm0-2v-5c0-1.654-1.346-3-3-3H7c-1.654 0-3 1.346-3 3v5h24zm-3-10h.557l-2.25-6H8.693l-2.25 6H25zm-15 7h12v-2H10v2z"></path>
                    </svg>
                </div>
                <p>Miễn phí đỗ xe máy</p>
            </li>
            <li class="flex gap-2 py-1 line-through">
                <div class="w-6 h-6 pt-1">
                    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" display="block" fill="currentcolor" name="breakfast" size="14" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M2 31a1 1 0 01-1-1 9 9 0 0117.945-1H21c.736 0 1.428-.265 1.971-.739a2.99 2.99 0 001.022-2.06L24 26V14H13v6h-2v-7a1 1 0 01.883-.993L12 12h13a1 1 0 01.993.883L26 13v2h4a1 1 0 01.993.883L31 16v9a1 1 0 01-.883.993L30 26h-4a4.99 4.99 0 01-1.714 3.768 4.982 4.982 0 01-3.025 1.225L21 31zm3.85-6.637a7.003 7.003 0 00-2.693 4.154l-.058.301-.028.182h4.103zM10 23c-.823 0-1.612.142-2.346.403L9.254 29h1.491l1.6-5.598a6.968 6.968 0 00-1.854-.385l-.25-.013zm4.151 1.363L12.825 29h4.103l-.027-.182a6.999 6.999 0 00-2.75-4.455zM29 17h-3v7h3zM19.994 1c-.002 2.062-.471 3.344-1.765 5.424l-.753 1.183C16.61 8.998 16.198 9.908 16.058 11h-2.015c.15-1.613.708-2.836 1.91-4.728l.563-.88C17.632 3.6 17.993 2.607 17.994.998zm5 0c-.002 2.062-.471 3.344-1.765 5.424l-.753 1.183C21.61 8.998 21.198 9.908 21.058 11h-2.015c.15-1.613.708-2.836 1.91-4.728l.563-.88C22.632 3.6 22.993 2.607 22.994.998z"></path>
                    </svg>
                </div>
                <p>Bữa sáng</p>
            </li>
            <li class="flex gap-2 py-1 @HotWaterKettle">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" name="mineral_water" size="14">
                        <path d="M0 0h24v24H0z" stroke="none"></path><path d="M10 5h4V3a1 1 0 00-1-1h-2a1 1 0 00-1 1v2z"></path><path d="M14 3.5c0 1.626.507 3.212 1.45 4.537l.05.07a8.093 8.093 0 011.5 4.694V19a2 2 0 01-2 2H9a2 2 0 01-2-2v-6.2c0-1.682.524-3.322 1.5-4.693l.05-.07A7.823 7.823 0 0010 3.5"></path>
                        <path d="M7.003 14.803A2.4 2.4 0 008 14a2.4 2.4 0 012-1 2.4 2.4 0 012 1 2.4 2.4 0 002 1 2.4 2.4 0 002-1 2.4 2.4 0 011-.805"></path>
                    </svg>
                </div>
                <p>Nước lọc miễn phí</p>
            </li>
            <li class="flex gap-2 py-1 @Party">
                <div class="w-6 h-6 pt-1">
                    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" display="block" fill="currentcolor" name="party" size="14" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M16 0c5.909 0 11 5.275 11 11 0 4.848-3.228 9.268-9.547 13.278L19.65 27.2a1.125 1.125 0 01-.9 1.801H17v3h-2v-3h-1.75a1.125 1.125 0 01-.901-1.799l2.14-2.862C8.212 20.918 5 16.457 5 11 5 4.925 9.925 0 16 0zm-.005 25.667L14.997 27h2zM16 2a9 9 0 00-9 9c0 4.606 2.722 8.428 8.309 11.508l.376.204.272.142.311-.192c5.61-3.533 8.474-7.246 8.715-11.126l.013-.27L25 11c0-4.636-4.212-9-9-9z"></path>
                    </svg>
                </div>
                <p>Tổ chức tiệc</p>
            </li>
            <li class="flex gap-2 py-1 @Kitchen">
                <div class="w-6 h-6 pt-1">
                    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" display="block" fill="currentcolor" name="kitchen" size="14" class="mr-3" style="height: 24px; width: 24px;">
                        <path d="M26 1a5 5 0 015 5c0 6.389-1.592 13.187-4 14.693V31h-2V20.694c-2.364-1.478-3.942-8.062-3.998-14.349L21 6l.005-.217A5 5 0 0126 1zm-9 0v18.118c2.317.557 4 3.01 4 5.882 0 3.27-2.183 6-5 6s-5-2.73-5-6c0-2.872 1.683-5.326 4-5.882V1zM2 1h1c4.47 0 6.934 6.365 6.999 18.505L10 21H3.999L4 31H2zm14 20c-1.602 0-3 1.748-3 4s1.398 4 3 4 3-1.748 3-4-1.398-4-3-4zM4 3.239V19h3.995l-.017-.964-.027-.949C7.673 9.157 6.235 4.623 4.224 3.364l-.12-.07zm19.005 2.585L23 6l.002.31c.045 4.321 1.031 9.133 1.999 11.39V3.17a3.002 3.002 0 00-1.996 2.654zm3.996-2.653v14.526C27.99 15.387 29 10.4 29 6a3.001 3.001 0 00-2-2.829z"></path>
                    </svg>
                </div>
                <p>Phòng Bếp</p>
            </li>
            <li class="flex gap-2 py-1 @CookingBasics">
                <div class="w-6 h-6 pt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" name="basic seasoning" size="14" class="mr-3">
                        <g fill="#5D7293" stroke="#5D7293">
                            <path d="M16.945 10.879L10.316.383c-.332-.5-.761-.492-1.21-.078l-6.852 6.09c-.453.41-.41.882-.012 1.234l9.551 7.96c.562.43 1.078.384 1.488.028l3.645-3.37c.41-.38.398-.75.02-1.368zm0 0M17.602 12.566l-4.063 3.746c2.078 1.54 5.613-1.382 4.063-3.746zm-2.028 3.946a.275.275 0 010-.551.275.275 0 010 .55zm1.18-.782a.274.274 0 01-.274-.273c0-.152.125-.273.274-.273.152 0 .277.12.277.273a.275.275 0 01-.277.273zm.766-1.164a.278.278 0 01-.278-.273c0-.152.125-.277.278-.277.148 0 .273.125.273.277a.277.277 0 01-.273.273zm0 0M19.348 16.941c0 .332-.27.606-.602.606a.606.606 0 010-1.211c.332 0 .602.27.602.605zm0 0M18.543 19.36a.606.606 0 01-1.21 0 .605.605 0 011.21 0zm0 0M20.156 20.168c0 .336-.27.605-.605.605a.606.606 0 11.605-.605zm0 0M19.852 22.184a.603.603 0 11-1.207 0c0-.332.27-.606.605-.606.332 0 .602.274.602.606zm0 0M22.07 23.395a.603.603 0 11-1.207 0c0-.332.27-.606.606-.606.332 0 .601.273.601.606zm0 0"></path>
                        </g>
                    </svg>
                </div>
                <p>Gia vị cơ bản</p>
            </li>
        </ul>
    </div>

    <p class="text-orange-600 underline underline-offset-2 cursor-pointer" data-modal-toggle="showAmenity">Xem thêm tiện ích</p>
    <!-- Main modal -->
    <div id="showAmenity" data-modal-backdrop="static" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-modal md:h-full">
        <div class="relative w-full h-full max-w-2xl md:h-auto">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                <!-- Modal header -->
                <div class="flex items-start justify-between p-4 border-b rounded-t dark:border-gray-600">
                    <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-toggle="showAmenity">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
                <!-- Modal body -->
                <div class="p-6 space-y-6 text-[#424F64] h-[80vh] overflow-y-auto">
                    <p class="text-xl font-medium">Nơi này có những gì cho bạn</p>
                    @{
                        var folders = @ListAmenities.GroupBy(x => x.Folder);
                        foreach (var folder in folders)
                        {
                            <div class="mb-2">
                                <p class="text-base font-medium ">@folder.Key</p>
                                @foreach (var amenity in folder.ToList())
                                {
                                    <div >
                                        <p class="flex gap-2 py-5 border-b border-gray-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6"/>
                                            </svg>
                                            @amenity.Name
                                        </p>
                                    </div>
                                }
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>


@code {
    private string Css { get; set; } = "";
    private Task<IJSObjectReference>? _module;
        const string ImportPath = "./_content/GoStay.Seli/js/index.js";

    private Task<IJSObjectReference> Module => _module ??= JsRuntime.InvokeAsync<IJSObjectReference>("import",
        ImportPath).AsTask();

    [Parameter]
    public GohomeListingDetailForCus? Data { get; set; }

    [Parameter]
    public long ListingId { get; set; }

    string[] ListDescription { get; set; } = {};
    Collection<AmenityModel> ListAmenities { get; set; } = new Collection<AmenityModel>();
    private AmenityModel? AmenityModel { get; set; } = new();

    #region Amenities Search

    string? Tv { get; set; } = "line-through";
    string? Netflix { get; set; } = "line-through";
    string? Pool { get; set; } = "line-through";
    string? Essentials { get; set; } = "line-through";
    string? FreeParkingMoto { get; set; } = "line-through";
    string? FreeParkingStreet { get; set; } = "line-through";
    string? CookingBasics { get; set; } = "line-through";
    string? Kitchen { get; set; } = "line-through";
    string? HotWaterKettle { get; set; } = "line-through";
    string? Party { get; set; } = "line-through";
    string? FreeParkingCar { get; set; } = "line-through";

    #endregion

    private IEnumerable<HostListing>? ResponseHost { get; set; }

    protected override async void OnParametersSet()
    {
        if (Data != null)
        {
            ResponseHost = await Api.GetIns().ListingNewDetailPageApi.GetHostByListingIDAsync(Data.Id);
            if (Data?.Description != null)
            {
                ListDescription = Data.Description.Split("\n");
            }
            
            ListAmenities = await Api.GetIns().ListingNewDetailPageApi.GetAmenitiesByListingIdAsync(Data.Id);

            foreach (var amenities in ListAmenities)
            {
                switch (amenities.Id)
                {
                    case 91:
                        Tv = "";
                        break;
                    case 92:
                        Netflix = "";
                        break;
                    case 63:
                        Essentials = "";
                        break;
                    case 81:
                        Pool = "";
                        break;
                    case 87:
                        FreeParkingMoto = "";
                        break;
                    case 85:
                        FreeParkingStreet = "";
                        break;
                    case 95:
                        CookingBasics = "";
                        break;
                    case 68:
                        Kitchen = "";
                        break;
                    case 90:
                        HotWaterKettle = "";
                        break;
                    case 96:
                        Party = "";
                        break;
                    case 84:
                        FreeParkingCar = "";
                        break;
                }
            }
        }
        StateHasChanged();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Flowbie.initModal();
        }
    }

    private void User(long Id)
    {
        NavigationManager.NavigateTo("/user/" + Id);
    }

}